rules_version = '2';

service cloud.firestore {
	match /databases/{database}/documents {
		function signedIn() {
			return request.auth != null;
		}

		match /profiles/{uid} {
			allow read, write: if signedIn() && request.auth.uid == uid;
		}

		match /intentCards/{cardId} {
			allow read: if signedIn() && (resource.data.isPublic == true || resource.data.ownerUid == request.auth.uid);
			allow create: if signedIn() && request.resource.data.ownerUid == request.auth.uid;
			allow update, delete: if signedIn() && resource.data.ownerUid == request.auth.uid;
		}

		match /connectionRequests/{requestId} {
			allow create: if signedIn() && request.resource.data.fromUid == request.auth.uid;
			allow read: if signedIn() && (resource.data.fromUid == request.auth.uid || resource.data.toUid == request.auth.uid);
			allow update: if signedIn() && resource.data.toUid == request.auth.uid
				&& request.resource.data.fromUid == resource.data.fromUid
				&& request.resource.data.toUid == resource.data.toUid;
			allow delete: if signedIn() && (resource.data.fromUid == request.auth.uid || resource.data.toUid == request.auth.uid);
		}

		match /connections/{connectionId} {
			allow read: if signedIn() && (request.auth.uid in resource.data.uids);
			allow create: if signedIn() && (request.auth.uid in request.resource.data.uids);
			allow update, delete: if false;
		}
	}
}
